<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tanda Terima Barang Keluar - SIWARAS UT</title>
    <link rel="stylesheet" href="../../assets/style/main.css" />
    <link rel="stylesheet" href="../../assets/style/dashboard.css" />
    <link rel="stylesheet" href="../../assets/style/stokBarang.css" />
    <link rel="stylesheet" href="../../assets/style/tandaTerima.css" />
    <link rel="stylesheet" href="../../assets/style/toast.css" />
</head>

<body>
    <!-- Loader -->
    <div id="loader" class="loader-overlay">
        <div class="spinner"></div>
        <span>Loading...</span>
    </div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../assets/icon/logo-ut.png" alt="Logo UT" class="sidebar-logo" />
                <span class="sidebar-brand">SIWARAS UT</span>
            </div>

            <nav class="sidebar-nav">
                <a href="adminWisuda.html" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                    </svg>
                    <span>Beranda</span>
                    <svg class="nav-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                    </svg>
                </a>

                <a href="barangMasukWisuda.html" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM11 7h2v2h-2zm0 4h2v6h-2z" />
                    </svg>
                    <span>Barang Masuk</span>
                    <svg class="nav-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                    </svg>
                </a>

                <a href="stokBarangWisuda.html" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z" />
                    </svg>
                    <span>Stok Barang</span>
                    <svg class="nav-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                    </svg>
                </a>

                <a href="tandaTerimaWisuda.html" class="nav-item active">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z" />
                    </svg>
                    <span>Tanda Terima</span>
                    <svg class="nav-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                    </svg>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout-sidebar" onclick="handleLogout()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 13v-2H7V8l-5 4 5 4v-3z" />
                        <path
                            d="M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z" />
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="dashboard-header">
                <h1 class="dashboard-title">Tanda Terima Barang Keluar</h1>
                <div class="header-actions">
                    <!-- Theme Toggle Button -->
                    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                            fill="currentColor">
                            <path
                                d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
                        </svg>
                        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button class="btn-profile">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
                        </svg>
                    </button>
                </div>
            </header>

            <div class="stok-barang-section">
                <div class="stok-header">
                    <div class="search-sort-wrapper">
                        <div class="search-box">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z" />
                            </svg>
                            <input type="text" id="searchInput" placeholder="Cari keterangan..." />
                        </div>
                        <button class="sort-btn" onclick="toggleSort()">
                            <span>A</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7 10l5 5 5-5z" />
                            </svg>
                            <span>Z</span>
                        </button>
                    </div>
                    <button class="btn-add" onclick="openAddModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Tambah Tanda Terima
                    </button>
                </div>

                <div class="table-wrapper">
                    <table class="stok-table">
                        <thead>
                            <tr>
                                <th>NO</th>
                                <th>ID Tanda Terima</th>
                                <th>Keterangan</th>
                                <th>Tanggal</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px">
                                    Memuat data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Add Tanda Terima -->
    <div id="modalAdd" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Tambah Tanda Terima Baru</h2>
                <button class="btn-close" onclick="closeAddModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <form id="addTandaTerimaForm">
                <div class="form-group">
                    <label for="tanggalAdd">Tanggal</label>
                    <input type="date" id="tanggalAdd" class="form-control" required />
                </div>

                <div class="form-group">
                    <label for="keteranganAdd">Keterangan</label>
                    <textarea id="keteranganAdd" class="form-control" rows="3" required
                        placeholder="Misal: Wisuda Periode 2025.1, Acara Dies Natalis, dll"></textarea>
                    <small class="form-hint">Deskripsi penggunaan barang keluar</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeAddModal()">Batal</button>
                    <button type="submit" class="btn-submit">Buat Tanda Terima</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detail Tanda Terima -->
    <div id="modalDetail" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="detailTitle">Detail Tanda Terima</h2>
                    <p class="detail-subtitle">
                        <span id="detailKeterangan"></span> •
                        <span id="detailTanggal"></span> •
                        <span id="detailStatus"></span>
                    </p>
                </div>
                <button class="btn-close" onclick="closeDetailModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>

            <div class="detail-content">
                <!-- Tabel Barang -->
                <div class="detail-section">
                    <div class="section-header">
                        <h3>Daftar Barang</h3>
                        <button class="btn-add-small" onclick="openAddBarangModal()" id="btnAddBarang">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            Tambah Barang
                        </button>
                    </div>

                    <div class="table-wrapper-small">
                        <table class="detail-table">
                            <thead>
                                <tr>
                                    <th>NO</th>
                                    <th>Kode Barang</th>
                                    <th>Nama Barang</th>
                                    <th>Satuan</th>
                                    <th>Jumlah</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tableBarang">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 20px; color: var(--text-muted)">
                                        Belum ada barang. Klik "Tambah Barang" untuk menambahkan.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Form Data Penerima -->
                <div class="detail-section">
                    <div class="section-header">
                        <h3>Data Penerima</h3>
                        <span class="hint-text">Klik 2x pada cell untuk edit</span>
                    </div>

                    <div class="table-wrapper-small">
                        <table class="detail-table editable-table">
                            <thead>
                                <tr>
                                    <th>NO</th>
                                    <th>Nama</th>
                                    <th>NIP/NIM</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="tableFormData">
                                <tr>
                                    <td>1</td>
                                    <td class="editable" data-field="nama" data-index="0" ondblclick="editCell(this)">
                                        <span class="cell-value">-</span>
                                        <input type="text" class="cell-input" style="display: none;" />
                                    </td>
                                    <td class="editable" data-field="nip" data-index="0" ondblclick="editCell(this)">
                                        <span class="cell-value">-</span>
                                        <input type="text" class="cell-input" style="display: none;" />
                                    </td>
                                    <td class="editable" data-field="keterangan" data-index="0"
                                        ondblclick="editCell(this)">
                                        <span class="cell-value">-</span>
                                        <input type="text" class="cell-input" style="display: none;" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="detail-actions">
                    <button type="button" class="btn-cancel" onclick="closeDetailModal()">Kembali</button>
                    <button type="button" class="btn-warning" onclick="validateTandaTerima()" id="btnValidate">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="width: 20px; height: 20px;">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                        </svg>
                        Validasi Data
                    </button>
                    <button type="button" class="btn-submit" onclick="generatePDF()" id="btnPDF" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="width: 20px; height: 20px;">
                            <path
                                d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z" />
                        </svg>
                        Cetak PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Add Barang -->
    <div id="modalAddBarang" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Tambah Barang ke Daftar</h2>
                <button class="btn-close" onclick="closeAddBarangModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <form id="addBarangForm">
                <div class="form-group">
                    <label for="selectBarang">Pilih Barang</label>
                    <select id="selectBarang" class="form-control" required onchange="updateBarangInfo()">
                        <option value="">-- Pilih Barang --</option>
                    </select>
                    <small class="form-hint">Pilih barang yang akan dikeluarkan</small>
                </div>

                <div id="barangInfo" style="display: none;">
                    <div class="info-card">
                        <div class="info-row">
                            <span class="label">Kode Barang:</span>
                            <span class="value" id="infoKodeBarang">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Nama Barang:</span>
                            <span class="value" id="infoNamaBarang">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Satuan:</span>
                            <span class="value" id="infoSatuan">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Stok Tersedia:</span>
                            <span class="value" id="infoStok">0</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="jumlahBarang">Jumlah yang Dikeluarkan</label>
                        <input type="number" id="jumlahBarang" class="form-control" required min="1" placeholder="0" />
                        <small class="form-hint">Masukkan jumlah barang yang akan dikeluarkan</small>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeAddBarangModal()">Batal</button>
                    <button type="submit" class="btn-submit">Tambahkan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load libraries first, then app scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="../../script/config.js"></script>
    <script src="../../script/tandaTerimaWisuda.js"></script>
    <script src="../../script/toast.js"></script>
</body>

</html>